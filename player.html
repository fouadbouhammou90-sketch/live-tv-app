<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini Ultra Player</title>
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        .p-box { position: relative; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
        video { width: 100%; height: 100%; object-fit: contain; }
        
        .loader { position: absolute; width: 50px; height: 50px; border: 4px solid #333; border-top-color: #00d2ff; border-radius: 50%; animation: spin 1s infinite linear; z-index: 10; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .ui { position: absolute; inset: 0; z-index: 20; display: flex; flex-direction: column; justify-content: space-between; background: rgba(0,0,0,0.4); opacity: 0; transition: 0.3s; }
        .active-ui .ui { opacity: 1; }
        .controls { padding: 20px; display: flex; justify-content: center; gap: 40px; }
        .btn { background: none; border: none; color: white; font-size: 2.5rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="p-box" id="pBox">
        <div class="loader" id="loading"></div>
        <video id="v" playsinline crossorigin="anonymous" autoplay></video>

        <div class="ui">
            <div style="padding: 20px; text-align: center; color: white; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);">
                قناة مدفوعة مشفرة - Xtream Line
            </div>
            
            <div class="controls">
                <button class="btn" onclick="v.currentTime -= 10"><i class="fas fa-undo"></i></button>
                <button class="btn" style="font-size: 4rem;" onclick="toggleP()"><i id="pIcon" class="fas fa-pause"></i></button>
                <button class="btn" onclick="v.currentTime += 10"><i class="fas fa-redo"></i></button>
            </div>

            <div style="padding: 20px; display: flex; justify-content: space-around;">
                <button class="btn" style="font-size: 1.2rem;" onclick="v.style.objectFit='fill'">ملء الشاشة <i class="fas fa-expand"></i></button>
                <button class="btn" style="font-size: 1.2rem;" onclick="location.reload()">تحديث <i class="fas fa-sync"></i></button>
            </div>
        </div>
    </div>

    <script>
        const v = document.getElementById('v');
        const pBox = document.getElementById('pBox');
        
        // هام جداً: ضع هنا رابط الـ Cloudflare Worker الذي أنشأته
        const myProxy = "https://red-snowflake-3bb2.bouhammouamira.workers.dev/?url=";

        function playNow() {
            const params = new URLSearchParams(window.location.search);
            let targetUrl = params.get('url') ? atob(params.get('url')) : '';
            
            if (!targetUrl) return;

            // تمرير الرابط عبر البروكسي الخاص بك لكسر التشفير
            const finalUrl = myProxy + encodeURIComponent(targetUrl);

            if (Hls.isSupported()) {
                const hls = new Hls({
                    xhrSetup: (xhr) => {
                        // هنا يتم إرسال الهوية التي تجعل السيرفر يفتح البث
                        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                    }
                });
                hls.loadSource(finalUrl);
                hls.attachMedia(v);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    document.getElementById('loading').style.display = 'none';
                    v.play();
                });
            } else {
                v.src = finalUrl;
            }
        }

        function toggleP() {
            if (v.paused) { v.play(); document.getElementById('pIcon').className = 'fas fa-pause'; }
            else { v.pause(); document.getElementById('pIcon').className = 'fas fa-play'; }
        }

        pBox.onclick = () => pBox.classList.toggle('active-ui');

        playNow();
        pBox.classList.add('active-ui');
    </script>
</body>
</html>
